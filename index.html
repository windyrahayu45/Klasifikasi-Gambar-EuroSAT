<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EuroSAT TFJS Inference</title>
</head>
<body>
    <h2>Upload Image for Prediction</h2>
    <input type="file" id="imageUpload">
    <p id="prediction"></p>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script>
        async function loadModel() {
            console.log("Loading model...");
            const model = await tf.loadLayersModel("./tfjs_model/model.json");  // Perbaiki path
            console.log("Model loaded successfully!");
            return model;
        }

        async function predictImage(event) {
            const file = event.target.files[0];
            if (!file) return;

            const img = document.createElement("img");
            img.src = URL.createObjectURL(file);
            img.onload = async function () {
                const model = await loadModel();

                // Convert image to tensor
                const tensor = tf.browser.fromPixels(img)
                    .resizeNearestNeighbor([64, 64]) 
                    .toFloat()
                    .expandDims();

                // Predict dengan await
                const prediction = await model.predict(tensor);
                const result = prediction.argMax(-1).dataSync()[0];

                document.getElementById("prediction").innerText = `Predicted Class: ${result}`;
            };
        }

        document.getElementById("imageUpload").addEventListener("change", predictImage);
    </script>
</body>
</html>
